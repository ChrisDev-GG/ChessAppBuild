import{$ as j,Aa as U,C as x,E as u,F as N,Fa as q,H as w,I as o,J as r,K as S,M as T,N as b,O as d,Oa as G,Pa as K,Qa as Q,Ra as X,Sa as Y,Ua as Z,V as m,Va as $,W as E,Wa as ee,X as I,Xa as te,Y as k,Ya as ne,Z as P,Za as ie,_ as M,_a as oe,aa as O,ab as re,ba as W,bb as ae,ca as R,j as F,ja as A,ka as D,n as B,na as z,o as H,oa as J,p as C,q as g,u as s,v as L}from"./chunk-EQV5W4IK.js";var ce=()=>({width:"25rem"}),de=()=>({"background-color":"var(--surface-200)"}),pe=()=>({width:"600px",height:"250px"}),me=n=>({"surface-ground":n});function _e(n,l){if(n&1){let i=T();o(0,"div",12)(1,"p-floatLabel")(2,"p-inputNumber",13),M("ngModelChange",function(e){C(i);let a=d(2);return P(a.n_jugadores,e)||(a.n_jugadores=e),g(e)}),r(),o(3,"label",14),m(4,"N\xBA de Jugadores"),r()()(),o(5,"div",12)(6,"p-floatLabel")(7,"p-inputNumber",13),M("ngModelChange",function(e){C(i);let a=d(2);return P(a.n_rondas,e)||(a.n_rondas=e),g(e)}),r(),o(8,"label",14),m(9,"N\xBA de Rondas"),r()()(),o(10,"div",5)(11,"p-button",15),b("onClick",function(){C(i);let e=d(2);return g(e.onCreatePlayers())}),r()()}if(n&2){let i=d(2);s(2),k("ngModel",i.n_jugadores),s(5),k("ngModel",i.n_rondas),s(4),u("raised",!0)}}function ue(n,l){if(n&1){let i=T();o(0,"div",5)(1,"span",21)(2,"b"),m(3),r()()(),o(4,"div",22)(5,"input",23),M("ngModelChange",function(e){let a=C(i).$implicit;return P(a.name,e)||(a.name=e),g(e)}),r()()}if(n&2){let i=l.$implicit,t=l.options;s(3),E("Jugador "+(i.id+1)+" :"),s(),u("ngClass",O(3,me,t.odd)),s(),k("ngModel",i.name)}}function he(n,l){if(n&1){let i=T();o(0,"div",16)(1,"div",5)(2,"p-button",17),b("onClick",function(){C(i);let e=d(2);return g(e.addOneNewPlayer())}),r()(),o(3,"div",5)(4,"p-scroller",18),x(5,ue,6,5,"ng-template",19),r()()(),o(6,"div",5)(7,"p-button",20),b("onClick",function(){C(i);let e=d(2);return g(e.goToStep(1))}),r(),o(8,"p-button",15),b("onClick",function(){C(i);let e=d(2);return g(e.onNextRound())}),r()()}if(n&2){let i=d(2);s(2),u("raised",!0),s(2),N(j(7,pe)),u("items",i.players)("itemSize",50),s(3),u("raised",!0),s(),u("raised",!0)}}function Ce(n,l){n&1&&(o(0,"tr")(1,"th"),m(2,"Blancas"),r(),o(3,"th"),S(4,"i",29),r(),S(5,"th"),o(6,"th"),S(7,"i",29),r(),o(8,"th"),m(9,"Negras"),r()())}function ge(n,l){if(n&1){let i=T();o(0,"tr")(1,"td"),m(2),r(),o(3,"td")(4,"p-checkbox",30),M("ngModelChange",function(e){let a=C(i).$implicit;return P(a.whitePlayerScore,e)||(a.whitePlayerScore=e),g(e)}),b("onChange",function(){let e=C(i).$implicit,a=d(3);return g(a.onScoreChange(e,"white"))}),r()(),o(5,"td"),m(6,"vs"),r(),o(7,"td")(8,"p-checkbox",30),M("ngModelChange",function(e){let a=C(i).$implicit;return P(a.blackPlayerScore,e)||(a.blackPlayerScore=e),g(e)}),b("onChange",function(){let e=C(i).$implicit,a=d(3);return g(a.onScoreChange(e,"black"))}),r()(),o(9,"td"),m(10),r()()}if(n&2){let i=l.$implicit;s(2),E(i.whitePlayerName),s(2),k("ngModel",i.whitePlayerScore),s(4),k("ngModel",i.blackPlayerScore),s(2),E(i.blackPlayerName)}}function ye(n,l){if(n&1){let i=T();o(0,"div",4)(1,"div",5)(2,"p-table",6),x(3,Ce,10,0,"ng-template",2)(4,ge,11,4,"ng-template",7),r()()(),o(5,"div",5)(6,"p-button",24),b("onClick",function(){C(i);let e=d(2);return g(e.onNextRound())}),r()(),o(7,"div",25)(8,"p-button",26),b("onClick",function(){C(i);let e=d(2);return g(e.showScores=!0)}),r()(),o(9,"div",27)(10,"p-button",28),b("onClick",function(){C(i);let e=d(2);return g(e.goToStep(1))}),r()()}if(n&2){let i=d(2);s(2),u("value",i.currentRoundMatches),s(4),u("raised",!0),s(2),u("raised",!0),s(2),u("raised",!0)}}function fe(n,l){n&1&&(o(0,"tr")(1,"th"),m(2,"Jugador"),r(),o(3,"th"),m(4,"Puntaje Final"),r()())}function xe(n,l){n&1&&S(0,"i",32)}function be(n,l){if(n&1&&x(0,xe,1,0,"i",32),n&2){let i=d().$implicit,t=d(4);w(0,t.findWinner(i)?0:-1)}}function we(n,l){if(n&1&&(o(0,"tr")(1,"td"),m(2),W(3,"titlecase"),x(4,be,1,1),r(),o(5,"td"),m(6),r()()),n&2){let i=l.$implicit,t=d(4);s(2),I(" ",R(3,3,i.name)," "),s(2),w(4,t.ronda_actual==t.n_rondas+1?4:-1),s(2),E(i.score)}}function Se(n,l){if(n&1&&(o(0,"div",4)(1,"div",5)(2,"p-table",6),x(3,fe,5,0,"ng-template",2)(4,we,7,5,"ng-template",7),r()()()),n&2){let i=d(3);s(2),u("value",i.players)}}function ve(n,l){if(n&1){let i=T();o(0,"div"),x(1,Se,5,1,"div",31),r(),o(2,"div",27)(3,"p-button",28),b("onClick",function(){C(i);let e=d(2);return g(e.goToStep(1))}),r()(),o(4,"div",25)(5,"p-button",26),b("onClick",function(){C(i);let e=d(2);return g(e.showScores=!0)}),r()()}if(n&2){let i=d(2);s(),u("ngIf",i.ronda_actual>=i.n_rondas),s(2),u("raised",!0),s(2),u("raised",!0)}}function Te(n,l){if(n&1&&(o(0,"div",0)(1,"p-card")(2,"div",5),S(3,"img",10),o(4,"h2",11),m(5,"Creaci\xF3n de Plantilla"),r(),S(6,"img",10),r(),S(7,"br"),x(8,_e,12,3)(9,he,9,8)(10,ye,11,4)(11,ve,6,3),r()()),n&2){let i=d();s(),N(j(6,de)),s(7),w(8,i.step==1?8:-1),s(),w(9,i.step==2?9:-1),s(),w(10,i.step==3&&i.currentRoundMatches?10:-1),s(),w(11,i.step==4?11:-1)}}function ke(n,l){n&1&&(o(0,"div",5)(1,"h5",33),S(2,"i",34),m(3,"Puntajes"),r()())}function Pe(n,l){n&1&&(o(0,"tr")(1,"th"),m(2,"Jugador"),r(),o(3,"th"),m(4,"Puntaje Final"),r()())}function Me(n,l){n&1&&S(0,"i",32)}function Ee(n,l){if(n&1&&x(0,Me,1,0,"i",32),n&2){let i=d().$implicit,t=d();w(0,t.findWinner(i)?0:-1)}}function Ve(n,l){if(n&1&&(o(0,"tr")(1,"td"),m(2),W(3,"titlecase"),x(4,Ee,1,1),r(),o(5,"td"),m(6),r()()),n&2){let i=l.$implicit,t=d();s(2),I(" ",R(3,3,i.name)," "),s(2),w(4,t.ronda_actual==t.n_rondas+1?4:-1),s(2),E(i.score)}}var le=(()=>{let l=class l{constructor(t){this.alertsService=t,this.token=localStorage.getItem("token")||null,this.step=1,this.n_jugadores=0,this.n_rondas=0,this.ronda_actual=1,this.players=[],this.currentRoundMatches=[],this.showScores=!1}ngOnInit(){}onCreatePlayers(){this.players=this.generatePlayersObject()}addOneNewPlayer(){this.n_jugadores++,this.players=[...this.players,{id:this.n_jugadores-1,name:"",colorHistory:[],winner:!1,score:0}]}onInitTournament(){if(this.players.filter(e=>e.name!=="").length<this.n_jugadores)return this.alertsService.warningMessage("Error","Todos los jugadores deben tener un nombre");this.step=3}generatePlayersObject(){if(this.n_jugadores<2)return this.alertsService.warningMessage("N\xBA de Jugadores inv\xE1lido","Debe haber al menos 2 jugadores"),[];if(this.n_rondas<1)return this.alertsService.warningMessage("N\xBA de Rondas inv\xE1lido","Debe haber al menos 1 ronda"),[];let t=[];for(let e=0;e<this.n_jugadores;e++)t.push({id:e,name:"",score:0,colorHistory:[],winner:!1,opponents:[]});return this.step=2,t}generateFirstRound(){if(this.players.length<2){this.alertsService.warningMessage("Error","M\xEDnimo 2 jugadores para iniciar");return}if(this.players.filter(c=>c.name!=="").length<this.n_jugadores)return this.alertsService.warningMessage("Error","Jugadores sin nombre");if(this.players.filter((c,y,V)=>y===V.findIndex(h=>h.name===c.name)).length<this.n_jugadores)return this.alertsService.warningMessage("Error","Nombre de jugadores repetidos");let a=[],p=[...this.players];for(;p.length>1;){let c=Math.floor(Math.random()*p.length),y=p.splice(c,1)[0],V=Math.floor(Math.random()*p.length),h=p.splice(V,1)[0],_=Math.random()>.5?y:h,f=_===y?h:y;a.push({whitePlayerId:_.id,blackPlayerId:f.id,whitePlayerName:_.name,blackPlayerName:f.name,whitePlayerScore:0,blackPlayerScore:0}),_.colorHistory.push("white"),f.colorHistory.push("black"),_.opponents.push(f.id),f.opponents.push(_.id)}if(p.length===1){let c=p[0];c.colorHistory.push("bye"),c.opponents.push(-1)}this.currentRoundMatches=a,console.log(this.currentRoundMatches),this.step=3}generateNextRound(){if(this.ronda_actual==this.n_rondas+1){this.step=4,this.alertsService.successMessage("Torneo Finalizado","El torneo ha finalizado, puedes ver los resultados en la tabla de posiciones.");return}let t=[...this.players].sort((p,c)=>c.score-p.score),e=[],a=new Set;for(let p=0;p<t.length;p++){let c=t[p];if(a.has(c.id))continue;let y=null,V=1;for(let f=p+1;f<t.length;f++){let v=t[f];if(!a.has(v.id)&&!c.opponents?.includes(v.id)&&Math.abs(c.score-v.score)<=V){y=v;break}}if(!y)for(let f=p+1;f<t.length;f++){let v=t[f];if(!a.has(v.id)){y=v;break}}if(!y){c.colorHistory.push("bye"),c.opponents=c.opponents||[],c.opponents.push(-1);continue}let h,_;c.colorHistory[this.ronda_actual-2]==="white"?(h=y,_=c):y.colorHistory[this.ronda_actual-2]==="white"?(h=c,_=y):(h=Math.random()>.5?c:y,_=h===c?y:c),e.push({whitePlayerId:h.id,blackPlayerId:_.id,whitePlayerName:h.name,blackPlayerName:_.name,whitePlayerScore:0,blackPlayerScore:0}),h.colorHistory.push("white"),_.colorHistory.push("black"),h.opponents=h.opponents||[],_.opponents=_.opponents||[],h.opponents.push(_.id),_.opponents.push(h.id),a.add(h.id),a.add(_.id)}this.currentRoundMatches=e,console.log(this.currentRoundMatches),this.ronda_actual++}updatePlayerScores(){this.currentRoundMatches.forEach(t=>{let e=this.players.find(p=>p.id===t.whitePlayerId),a=this.players.find(p=>p.id===t.blackPlayerId);e&&a&&(e.score+=t.whitePlayerScore?1:0,a.score+=t.blackPlayerScore?1:0)})}onNextRound(){console.log("RONDA ACTUAL: "+this.ronda_actual),console.log("N\xBA RONDAS: "+this.n_rondas),this.ronda_actual==1?(this.onInitTournament(),this.step==3&&this.generateFirstRound(),this.ronda_actual++):(this.updatePlayerScores(),this.generateNextRound())}onScoreChange(t,e){e==="white"?(t.whitePlayerScore=1,t.blackPlayerScore=0):(t.whitePlayerScore=0,t.blackPlayerScore=1)}findWinner(t){let a=[...this.players].sort((p,c)=>c.score-p.score)[0].id;return t.id==a}goToStep(t){switch(t){case 1:this.ronda_actual=1,this.step=1;break;case 2:this.ronda_actual=1,this.step=2;break;case 3:this.step=3;break}}};l.\u0275fac=function(e){return new(e||l)(L(ae))},l.\u0275cmp=B({type:l,selectors:[["app-tournaments"]],decls:12,vars:8,consts:[[1,"px-3","sm:px-8","py-3","mt-8"],["maskStyleClass","dialog-mask","appendTo","body",3,"visibleChange","modal","visible","closable"],["pTemplate","header"],[1,"border-round","p-3"],[1,"mb-5"],[1,"flex","justify-content-center"],[3,"value"],["pTemplate","body"],[1,"flex","justify-content-center","gap-2"],["icon","pi pi-times","label","Cerrar","size","small",3,"click"],["src","assets/img/board-icon.svg","alt","Chess","width","30",1,"icon"],[1,"ml-3","mr-3"],[1,"flex","justify-content-center","mb-5"],["inputId","integeronly",3,"ngModelChange","ngModel"],["for","number-input"],["label","Continuar","severity","contrast",3,"onClick","raised"],[1,"mb-3"],["label","+ A\xF1adir un nuevo jugador","severity","info","styleClass","mb-3",3,"onClick","raised"],["scrollHeight","250px","styleClass","border-1 surface-border",3,"items","itemSize"],["pTemplate","item"],["label","Volver","severity","contrast","styleClass","mr-3",3,"onClick","raised"],[1,"mr-2"],[1,"flex","justify-content-center","py-2",2,"height","50px",3,"ngClass"],["type","text","pInputText","","id","email","aria-describedby","email-help",3,"ngModelChange","ngModel"],["label","Siguiente Ronda","severity","contrast",3,"onClick","raised"],[1,"flex","justify-content-center","mt-4","mb-1"],["label","Ver puntajes","severity","info",3,"onClick","raised"],[1,"flex","justify-content-center","mt-3"],["label","Volver al inicio","severity","primary",3,"onClick","raised"],[1,"pi","pi-crown"],["binary","true",3,"ngModelChange","onChange","ngModel"],["class","mb-5",4,"ngIf"],[1,"pi","pi-crown","ml-3"],[1,"mb-0","pb-0"],[1,"pi","pi-eye","mr-2",2,"font-size","1.1rem"]],template:function(e,a){e&1&&(x(0,Te,12,7,"div",0),o(1,"p-dialog",1),M("visibleChange",function(c){return P(a.showScores,c)||(a.showScores=c),c}),x(2,ke,4,0,"ng-template",2),o(3,"div",3)(4,"div")(5,"div",4)(6,"div",5)(7,"p-table",6),x(8,Pe,5,0,"ng-template",2)(9,Ve,7,5,"ng-template",7),r()()()()(),o(10,"div",8)(11,"p-button",9),b("click",function(){return a.showScores=!1}),r()()()),e&2&&(w(0,a.token?0:-1),s(),N(j(7,ce)),u("modal",!0),k("visible",a.showScores),u("closable",!1),s(6),u("value",a.players))},dependencies:[A,D,U,Y,Z,ee,te,$,G,ne,ie,oe,K,Q,X,z],styles:["[_nghost-%COMP%]     .p-scroller-viewport{flex:none}"]});let n=l;return n})();var Qe=(()=>{let l=class l{};l.\u0275fac=function(e){return new(e||l)},l.\u0275mod=H({type:l}),l.\u0275inj=F({imports:[J,re,q.forChild([{path:"",component:le}])]});let n=l;return n})();export{Qe as TournamentsModule};
