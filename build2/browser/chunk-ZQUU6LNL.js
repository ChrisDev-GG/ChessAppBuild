import{$ as F,Ba as O,C as x,E as g,F as V,H as w,I as a,J as o,K as k,Ka as D,La as z,M as b,Ma as J,N as f,Na as G,O as d,Oa as U,Qa as q,Ra as K,Sa as Q,Ta as X,Ua as Y,V as _,Va as Z,W as S,X as v,Xa as $,Y as T,Ya as ee,Z as P,_ as N,ga as H,ha as B,j as I,ka as L,n as j,o as R,p as u,q as h,u as s,v as W,wa as A}from"./chunk-X37O4XGY.js";var ie=()=>({"background-color":"var(--surface-200)"}),oe=()=>({width:"600px",height:"250px"}),re=i=>({"surface-ground":i});function ae(i,l){if(i&1){let t=b();a(0,"div",4)(1,"p-floatLabel")(2,"p-inputNumber",5),P("ngModelChange",function(e){u(t);let r=d(2);return T(r.n_jugadores,e)||(r.n_jugadores=e),h(e)}),o(),a(3,"label",6),_(4,"N\xBA de Jugadores"),o()()(),a(5,"div",4)(6,"p-floatLabel")(7,"p-inputNumber",5),P("ngModelChange",function(e){u(t);let r=d(2);return T(r.n_rondas,e)||(r.n_rondas=e),h(e)}),o(),a(8,"label",6),_(9,"N\xBA de Rondas"),o()()(),a(10,"div",1)(11,"p-button",7),f("onClick",function(){u(t);let e=d(2);return h(e.onCreatePlayers())}),o()()}if(i&2){let t=d(2);s(2),v("ngModel",t.n_jugadores),s(5),v("ngModel",t.n_rondas),s(4),g("raised",!0)}}function le(i,l){if(i&1){let t=b();a(0,"div",13)(1,"span",14)(2,"b"),_(3),o()(),a(4,"input",15),P("ngModelChange",function(e){let r=u(t).$implicit;return T(r.name,e)||(r.name=e),h(e)}),o()()}if(i&2){let t=l.$implicit,n=l.options;g("ngClass",F(3,re,n.odd)),s(3),S("Jugador "+(t.id+1)+" :"),s(),v("ngModel",t.name)}}function se(i,l){if(i&1){let t=b();a(0,"div",8)(1,"div",1)(2,"p-button",9),f("onClick",function(){u(t);let e=d(2);return h(e.addOneNewPlayer())}),o()(),a(3,"div",1)(4,"p-scroller",10),x(5,le,5,5,"ng-template",11),o()()(),a(6,"div",1)(7,"p-button",12),f("onClick",function(){u(t);let e=d(2);return h(e.goToStep(1))}),o(),a(8,"p-button",7),f("onClick",function(){u(t);let e=d(2);return h(e.onNextRound())}),o()()}if(i&2){let t=d(2);s(2),g("raised",!0),s(2),V(N(7,oe)),g("items",t.players)("itemSize",50),s(3),g("raised",!0),s(),g("raised",!0)}}function ce(i,l){i&1&&(a(0,"tr")(1,"th"),_(2,"Blancas"),o(),a(3,"th"),_(4,"Ganador"),o(),k(5,"th"),a(6,"th"),_(7,"Ganador"),o(),a(8,"th"),_(9,"Negras"),o()())}function de(i,l){if(i&1){let t=b();a(0,"tr")(1,"td"),_(2),o(),a(3,"td")(4,"p-checkbox",23),P("ngModelChange",function(e){let r=u(t).$implicit;return T(r.whitePlayerScore,e)||(r.whitePlayerScore=e),h(e)}),f("onChange",function(){let e=u(t).$implicit,r=d(3);return h(r.onScoreChange(e,"white"))}),o()(),a(5,"td"),_(6,"vs"),o(),a(7,"td")(8,"p-checkbox",23),P("ngModelChange",function(e){let r=u(t).$implicit;return T(r.blackPlayerScore,e)||(r.blackPlayerScore=e),h(e)}),f("onChange",function(){let e=u(t).$implicit,r=d(3);return h(r.onScoreChange(e,"black"))}),o()(),a(9,"td"),_(10),o()()}if(i&2){let t=l.$implicit;s(2),S(t.whitePlayerName),s(2),v("ngModel",t.whitePlayerScore),s(4),v("ngModel",t.blackPlayerScore),s(2),S(t.blackPlayerName)}}function pe(i,l){if(i&1){let t=b();a(0,"div",16)(1,"div",1)(2,"p-table",17),x(3,ce,10,0,"ng-template",18)(4,de,11,4,"ng-template",19),o()()(),a(5,"div",1)(6,"p-button",20),f("onClick",function(){u(t);let e=d(2);return h(e.onNextRound())}),o()(),a(7,"div",21)(8,"p-button",22),f("onClick",function(){u(t);let e=d(2);return h(e.goToStep(1))}),o()()}if(i&2){let t=d(2);s(2),g("value",t.currentRoundMatches),s(4),g("raised",!0),s(2),g("raised",!0)}}function me(i,l){i&1&&(a(0,"tr")(1,"th"),_(2,"Jugador"),o(),a(3,"th"),_(4,"Puntaje Final"),o()())}function _e(i,l){if(i&1&&(a(0,"tr")(1,"td"),_(2),o(),a(3,"td"),_(4),o()()),i&2){let t=l.$implicit;s(2),S(t.name),s(2),S(t.score)}}function ue(i,l){if(i&1&&(a(0,"div",16)(1,"div",1)(2,"p-table",17),x(3,me,5,0,"ng-template",18)(4,_e,5,2,"ng-template",19),o()()()),i&2){let t=d(3);s(2),g("value",t.players)}}function he(i,l){if(i&1){let t=b();a(0,"div"),x(1,ue,5,1,"div",24),o(),a(2,"div",21)(3,"p-button",22),f("onClick",function(){u(t);let e=d(2);return h(e.goToStep(1))}),o()()}if(i&2){let t=d(2);s(),g("ngIf",t.ronda_actual>t.n_rondas),s(2),g("raised",!0)}}function Ce(i,l){if(i&1&&(a(0,"div",0)(1,"p-card")(2,"div",1),k(3,"img",2),a(4,"h2",3),_(5,"Creaci\xF3n de Plantilla"),o(),k(6,"img",2),o(),k(7,"br"),x(8,ae,12,3)(9,se,9,8)(10,pe,9,3)(11,he,4,2),o()()),i&2){let t=d();s(),V(N(6,ie)),s(7),w(8,t.step==1?8:-1),s(),w(9,t.step==2?9:-1),s(),w(10,t.step==3&&t.currentRoundMatches?10:-1),s(),w(11,t.step==4?11:-1)}}var te=(()=>{let l=class l{constructor(n){this.alertsService=n,this.token=localStorage.getItem("token")||null,this.step=1,this.n_jugadores=0,this.n_rondas=0,this.ronda_actual=1,this.players=[],this.currentRoundMatches=[]}ngOnInit(){}onCreatePlayers(){this.players=this.generatePlayersObject()}addOneNewPlayer(){this.n_jugadores++,this.players=[...this.players,{id:this.n_jugadores-1,name:"",colorHistory:[],winner:!1,score:0}]}onInitTournament(){if(this.players.filter(e=>e.name!=="").length<this.n_jugadores)return this.alertsService.warningMessage("Error","Todos los jugadores deben tener un nombre");this.step=3}generatePlayersObject(){if(this.n_jugadores<2)return this.alertsService.warningMessage("N\xBA de Jugadores inv\xE1lido","Debe haber al menos 2 jugadores"),[];if(this.n_rondas<1)return this.alertsService.warningMessage("N\xBA de Rondas inv\xE1lido","Debe haber al menos 1 ronda"),[];let n=[];for(let e=0;e<this.n_jugadores;e++)n.push({id:e,name:"",score:0,colorHistory:[],winner:!1,opponents:[]});return this.step=2,n}generateFirstRound(){if(this.players.length<2){this.alertsService.warningMessage("Error","Debe haber al menos 2 jugadores para iniciar el torneo.");return}let n=[],e=[...this.players];for(;e.length>1;){let r=Math.floor(Math.random()*e.length),C=e.splice(r,1)[0],m=Math.floor(Math.random()*e.length),y=e.splice(m,1)[0],c=Math.random()>.5?C:y,p=c===C?y:C;n.push({whitePlayerId:c.id,blackPlayerId:p.id,whitePlayerName:c.name,blackPlayerName:p.name,whitePlayerScore:0,blackPlayerScore:0}),c.colorHistory.push("white"),p.colorHistory.push("black"),c.opponents.push(p.id),p.opponents.push(c.id)}if(e.length===1){let r=e[0];r.colorHistory.push("bye"),r.opponents.push(-1)}this.currentRoundMatches=n,console.log(this.currentRoundMatches),this.ronda_actual=2,this.step=3}generateNextRound(){if(this.ronda_actual===this.n_rondas+1){this.step=4,this.alertsService.successMessage("Torneo Finalizado","El torneo ha finalizado, puedes ver los resultados en la tabla de posiciones.");return}let n=[...this.players].sort((C,m)=>m.score-C.score),e=[],r=new Set;for(let C=0;C<n.length;C++){let m=n[C];if(r.has(m.id))continue;let y=null;for(let M=C+1;M<n.length;M++){let E=n[M];if(!r.has(E.id)&&!m.opponents?.includes(E.id)){y=E;break}}if(!y){m.colorHistory.push("bye"),m.opponents=m.opponents||[],m.opponents.push(-1);continue}let c,p;m.colorHistory[this.ronda_actual-2]==="white"?(c=y,p=m):y.colorHistory[this.ronda_actual-2]==="white"?(c=m,p=y):(c=Math.random()>.5?m:y,p=c===m?y:m),e.push({whitePlayerId:c.id,blackPlayerId:p.id,whitePlayerName:c.name,blackPlayerName:p.name,whitePlayerScore:0,blackPlayerScore:0}),c.colorHistory.push("white"),p.colorHistory.push("black"),c.opponents=c.opponents||[],p.opponents=p.opponents||[],c.opponents.push(p.id),p.opponents.push(c.id),r.add(c.id),r.add(p.id)}this.currentRoundMatches=e,console.log(this.currentRoundMatches),this.ronda_actual++}updatePlayerScores(){this.currentRoundMatches.forEach(n=>{let e=this.players.find(C=>C.id===n.whitePlayerId),r=this.players.find(C=>C.id===n.blackPlayerId);e&&r&&(e.score+=n.whitePlayerScore?1:0,r.score+=n.blackPlayerScore?1:0)})}onNextRound(){console.log("RONDA ACTUAL: "+this.ronda_actual),this.ronda_actual==1?(this.onInitTournament(),this.step==3&&this.generateFirstRound(),this.ronda_actual++):(this.updatePlayerScores(),this.generateNextRound())}onScoreChange(n,e){e==="white"?(n.whitePlayerScore=1,n.blackPlayerScore=0):(n.whitePlayerScore=0,n.blackPlayerScore=1)}goToStep(n){switch(n){case 1:this.ronda_actual=1,this.step=1;break;case 2:this.ronda_actual=1,this.step=2;break;case 3:this.step=3;break}}};l.\u0275fac=function(e){return new(e||l)(W(ee))},l.\u0275cmp=j({type:l,selectors:[["app-tournaments"]],decls:1,vars:1,consts:[[1,"px-3","sm:px-8","py-3","mt-8"],[1,"flex","justify-content-center"],["src","assets/img/board-icon.svg","alt","Chess","width","30",1,"icon"],[1,"ml-3","mr-3"],[1,"flex","justify-content-center","mb-5"],["inputId","integeronly",3,"ngModelChange","ngModel"],["for","number-input"],["label","Continuar","severity","contrast",3,"onClick","raised"],[1,"mb-3"],["label","+ A\xF1adir un nuevo jugador","severity","info","styleClass","mb-3",3,"onClick","raised"],["scrollHeight","250px","styleClass","border-1 surface-border",3,"items","itemSize"],["pTemplate","item"],["label","Volver","severity","contrast","styleClass","mr-3",3,"onClick","raised"],[1,"flex","justify-content-center","py-2",2,"height","50px",3,"ngClass"],[1,"mr-2"],["type","text","pInputText","","id","email","aria-describedby","email-help",3,"ngModelChange","ngModel"],[1,"mb-5"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["label","Siguiente Ronda","severity","contrast",3,"onClick","raised"],[1,"flex","justify-content-center","mt-3"],["label","Volver al inicio","severity","primary",3,"onClick","raised"],["binary","true",3,"ngModelChange","onChange","ngModel"],["class","mb-5",4,"ngIf"]],template:function(e,r){e&1&&x(0,Ce,12,7,"div",0),e&2&&w(0,r.token?0:-1)},dependencies:[H,B,A,U,q,Q,X,K,D,Y,Z,z,J,G],styles:["[_nghost-%COMP%]     .p-scroller-viewport{flex:none}"]});let i=l;return i})();var Re=(()=>{let l=class l{};l.\u0275fac=function(e){return new(e||l)},l.\u0275mod=R({type:l}),l.\u0275inj=I({imports:[L,$,O.forChild([{path:"",component:te}])]});let i=l;return i})();export{Re as TournamentsModule};
